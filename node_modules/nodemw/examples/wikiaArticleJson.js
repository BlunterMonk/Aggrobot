#!/usr/bin/env node
/**
 * Example script for AsSimpleJson Wikia API
 *
 * @see http://poznan.wikia.com/api/v1#!/Articles/getAsSimpleJson_get_0
 * @see http://poznan.wikia.com/api/v1/Articles/AsSimpleJson?id=379
 */
'use strict';

const Bot = require( '..' ),
	client = new Bot( {
		server: 'exvius.gamepedia.com',
		path: '',
		debug: true
	} ),
	PAGE_ID = "Final_Fantasy_Brave_Exvius_Wiki"; // @see http://poznan.wikia.com/wiki/Katedra

	/*
const wikiClient = new wiki({
	protocol: "https", // Wikipedia now enforces HTTPS
	server: "exvius.gamepedia.com", // host name of MediaWiki-powered site
	path: "/", // path to api.php script
	debug: false // is more verbose when set to true
});
*/

// get current account information
client.wikia.call( '', { id: PAGE_ID }, ( err, data ) => {
	if ( err ) {
		console.log( err );
		return;
	}

	console.log(data);

	// extract the first paragraph
	let excerpt = data.sections
		// get content entries of type "paragraph"
			.map( ( section ) => section.content.filter( ( content ) => content.type === 'paragraph' ) )
			// filter out empty sections
			.filter( ( section ) => section.length > 0 )
			// extract the text value
			.shift().shift().text,
		images = [];

	console.log( 'Excerpt:', data.sections );

	// extract images
	data.sections
		// get images' src attribute
		.map( ( section ) => section.content.map( ( image ) => image ) )
		// filter out empty sections
		.filter( ( section ) => section.length > 0 )
		// flaten the list
		.forEach( ( section ) => images.push( ...section ) );

	console.log( JSON.stringify( images, null, '\t' ) );
} );
